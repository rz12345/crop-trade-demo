var app=angular.module("app",[]);app.controller("MainCtrl",["$scope","$http","$q",function(e,t,r){var a="http://www.zhutian.com.tw",o=t.get(a+"/crop-trade/json/markets"),c=t.get(a+"/crop-trade/json/crops");r.all([o,c]).then(function(t){var r=t[0].data,a=t[1].data;e.markets=r,e.crops=a,e.market_selected=e.markets[0].code,e.category_selected=e.crops[1].category,e.category_selected&&e.getCropList(e.category_selected)}),e.getCropList=function(t){angular.forEach(e.crops,function(r){return r.category===t?(e.crops_list=r.crops,e.crop_selected=e.crops_list[0].name,!0):void 0}),e.crop_selected&&e.getCropIdList(e.category_selected,e.crop_selected)},e.getCropIdList=function(t,r){angular.forEach(e.crops,function(a){a.category===t&&angular.forEach(a.crops,function(t){return t.name===r?(e.crops_id_list=t.data,e.crop_id_selected=e.crops_id_list[0].code,!0):void 0})}),e.crop_id_selected&&e.getCropTradePerMonth(e.market_selected,e.crop_id_selected)},e.getCropTradePerMonth=function(r,a){var o="/crop-trade/public/stats/"+r+"/"+a;t.get(o).success(function(t){e.crop_trade_per_month=t;var r=[],a=[],o=[],c=[],s=[],l=[],i={},p={};angular.forEach(e.crop_trade_per_month,function(e){r.push(e.trade_date.replace(/-01$/g,"")),s.push(parseFloat(e.price_avg)),a.push(parseFloat(e.price_top)),o.push(parseFloat(e.price_median)),c.push(parseFloat(e.price_bottom)),l.push(parseInt(e.amount))}),i.trade_date=r,i.data=[{type:"column",name:"交易量",color:"rgba(128, 133, 233, 0.30)",data:l,yAxis:1},{type:"line",name:"上價",color:Highcharts.getOptions().colors[1],data:a},{type:"line",name:"中價",color:Highcharts.getOptions().colors[2],data:o},{type:"line",name:"下價",color:Highcharts.getOptions().colors[3],data:c},{type:"line",name:"均價",color:Highcharts.getOptions().colors[0],data:s}],p.trade_date=r,p.data=[{type:"column",name:"交易量",data:l}],e.crop_trade_per_month.length>12?($("#price").show(),e.renderPriceChart(i.trade_date,i.data)):$("#price").hide()})},e.renderPriceChart=function(e,t){$("#price").highcharts({chart:{zoomType:"xy"},title:{text:"單一農產品每月均價"},subtitle:{text:"Source: http://amis.afa.gov.tw/"},xAxis:{categories:e,crosshair:!0},yAxis:[{labels:{format:"NT {value}",style:{color:Highcharts.getOptions().colors[1]}},title:{text:null},min:0},{labels:{format:"{value} 個",style:{color:"rgba(128, 133, 233, 1)"}},title:{text:null},min:0,opposite:!0}],tooltip:{shared:!0},legend:{layout:"vertical",align:"right",x:-80,verticalAlign:"top",y:20,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},series:t})}}]);